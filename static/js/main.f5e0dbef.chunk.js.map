{"version":3,"sources":["../../src/utils/useShareForwardRef.js","../../src/cache.js","../../src/asyncMeasurer.js","../../src/defaultMeasurementContainer.js","../../src/index.js","utils.js","App.js","index.js"],"names":["Cache","this","clearCache","containerStyle","display","position","visibility","zIndex","destroyMeasureLayer","container","document","measureElement","element","debug","createMeasureLayer","renderToString","child","height","width","defaultMeasurementContainer","style","children","forwardRef","data","cache","lazyMeasurement","recalculateItemsOnResize","measurementContainerElement","variableSizeListProps","listRef","forwardedRef","innerRef","useRef","useEffect","useShareForwardedRef","containerResizeDeps","measureIndex","index","ItemContainer","id","overflow","MeasurementContainer","overflowY","lazyCacheFill","setTimeout","handleListResize","debounce","useLayoutEffect","layout","ref","itemSize","itemCount","length","possibleOutputs","generateCommand","title","input","output","_","sample","knownSizes","App","useState","range","map","commands","setCommands","filter","setFilter","row","setRow","shouldShowList","setShouldShowList","dynamicListRef","filteredCommands","command","JSON","stringify","includes","jumpToRow","useCallback","current","scrollToItem","className","value","onChange","event","target","placeholder","min","max","step","onClick","whiteSpace","marginBottom","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.f5e0dbef.chunk.js","sourcesContent":["import { useEffect, useRef } from \"react\";\n\n/**\n * This hooks allows the component to hold a ref while also exposing the same ref to its parents.\n * For example:\n * const MyComponent = (props, ref) => {\n *   const innerRef = useShareForwardedRef(ref);\n *\n *   ...\n *\n *   return <div ref={ref}>\n *    ...\n *   </div>\n * }\n *\n * https://gist.github.com/pie6k/b4717f392d773a71f67e110b42927fea\n */\nconst useShareForwardedRef = forwardedRef => {\n  // final ref that will share value with forward ref. this is the one we will attach to components\n  const innerRef = useRef(null);\n\n  // after every render - try to share current ref value with forwarded ref\n  useEffect(() => {\n    if (!forwardedRef) {\n      return;\n    }\n    if (typeof forwardedRef === \"function\") {\n      forwardedRef(innerRef.current);\n    } else {\n      forwardedRef.current = innerRef.current;\n    }\n  });\n\n  return innerRef;\n};\n\nexport default useShareForwardedRef;\n","/**\n * A very simple cache object which allows us to quickly clear all cached values.\n */\nexport default class Cache {\n  constructor(initialValues) {\n    this.values = { ...initialValues };\n  }\n\n  clearCache() {\n    this.values = {};\n  }\n}\n","/**\n * We are using reactDom.browserServer.renderToString and not reactDom.render in order to\n * allow us to measure the elements from a different components render function.\n * If you call reactDom.render from another components render function react will crash with the following\n * error:\n * Warning: Render methods should be a pure function of props and state;\n * triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.\n */\nimport { renderToString } from \"react-dom/server\";\n\nconst containerStyle = {\n  display: \"inline-block\",\n  position: \"absolute\",\n  visibility: \"hidden\",\n  zIndex: -1\n};\n\n/**\n * Creates the hidden div appended to the document body\n */\nexport const createMeasureLayer = debug => {\n  const container = document.createElement(\"div\");\n  container.setAttribute(\"id\", \"measure-layer\");\n  if (!debug) {\n    container.style = containerStyle;\n  }\n  document.body.appendChild(container);\n  return container;\n};\n\n/**\n * Destroy the measuring layer.\n * Should be called when the dynamic list is unmounted.\n */\nexport const destroyMeasureLayer = () => {\n  const container = document.querySelector(\"#measure-layer\");\n  if (container) {\n    container.parentNode.removeChild(container);\n  }\n};\n\n/**\n * Measure an element by temporary rendering it.\n */\nconst measureElement = (element, debug) => {\n  const container =\n    document.querySelector(\"#measure-layer\") || createMeasureLayer(debug);\n\n  // Renders the React element into the hidden div\n  container.innerHTML = renderToString(element);\n\n  // Gets the element size\n  const child = container.querySelector(\"#item-container\");\n  const height = child.offsetHeight;\n  const width = child.offsetWidth;\n\n  // Removes the element from the document\n  if (!debug) {\n    container.innerHTML = \"\";\n  }\n\n  return { height, width };\n};\n\nexport default measureElement;\n","import React from \"react\";\n\nexport const defaultMeasurementContainer = ({ style, children }) => (\n  <div style={style}> {children} </div>\n);\n","import React, { useEffect, forwardRef, useLayoutEffect } from \"react\";\nimport { VariableSizeList } from \"react-window\";\nimport debounce from \"lodash.debounce\";\n\nimport useShareForwardedRef from \"./utils/useShareForwardRef\";\nimport Cache from \"./cache\";\nimport measureElement, { destroyMeasureLayer } from \"./asyncMeasurer\";\nimport { defaultMeasurementContainer } from \"./defaultMeasurementContainer\";\n\n/**\n * Create the dynamic list's cache object.\n * @param {Object} knownSizes a mapping between an items id and its size.\n */\nexport const createCache = (knownSizes = {}) => new Cache(knownSizes);\n\n/**\n * A virtualized list which handles item of varying sizes.\n * Read the implementation section in the README for additional information on the general algorithm.\n */\nconst DynamicList = (\n  {\n    children,\n    data,\n    height,\n    width,\n    cache,\n    lazyMeasurement = true,\n    recalculateItemsOnResize = { width: false, height: false },\n    measurementContainerElement = defaultMeasurementContainer,\n    debug = false,\n    ...variableSizeListProps\n  },\n  ref\n) => {\n  const listRef = useShareForwardedRef(ref);\n  const containerResizeDeps = [];\n\n  if (recalculateItemsOnResize.width) {\n    containerResizeDeps.push(width);\n  }\n  if (recalculateItemsOnResize.height) {\n    containerResizeDeps.push(height);\n  }\n\n  /**\n   * Measure a specific item.\n   * @param {number} index The index of the item in the data array.\n   */\n  const measureIndex = index => {\n    const ItemContainer = (\n      <div id=\"item-container\" style={{ overflow: \"auto\" }}>\n        {children({ index })}\n      </div>\n    );\n\n    const MeasurementContainer = measurementContainerElement({\n      style: { width, height, overflowY: \"scroll\" },\n      children: ItemContainer\n    });\n\n    const { height: measuredHeight } = measureElement(\n      MeasurementContainer,\n      debug\n    );\n    return measuredHeight;\n  };\n\n  /**\n   * Measure all of the items in the background.\n   * This could be a little tough in the site in the first seconds however it allows\n   * fast jumping.\n   */\n  const lazyCacheFill = () => {\n    data.forEach(({ id }, index) => {\n      // We use set timeout here in order to execute the measuring in a background thread.\n      setTimeout(() => {\n        if (!cache.values[id]) {\n          const height = measureIndex(index);\n\n          // Double check in case the main thread already populated this id\n          if (!cache.values[id]) {\n            cache.values[id] = height;\n          }\n        }\n      }, 0);\n    });\n  };\n\n  const handleListResize = debounce(() => {\n    if (listRef.current) {\n      cache.clearCache();\n      listRef.current.resetAfterIndex(0);\n      lazyCacheFill();\n    }\n  }, 50);\n\n  /**\n   * Initiate cache filling and handle cleanup of measurement layer.\n   */\n  useEffect(() => {\n    if (lazyMeasurement) {\n      lazyCacheFill();\n    }\n    return destroyMeasureLayer;\n  }, []);\n\n  /**\n   * Recalculate items size of the list size has changed.\n   */\n  useLayoutEffect(() => {\n    if (containerResizeDeps.length > 0) {\n      handleListResize();\n    }\n  }, containerResizeDeps);\n\n  /**\n   * In case the data length changed we need to reassign the current size to all of the indexes.\n   */\n  useEffect(() => {\n    if (listRef.current) {\n      listRef.current.resetAfterIndex(0);\n    }\n  }, [data.length]);\n\n  /**\n   * Get the size of the item.\n   * @param {number} index The index of the item in the data array.\n   */\n  const itemSize = index => {\n    const { id } = data[index];\n    if (cache.values[id]) {\n      return cache.values[id];\n    } else {\n      const height = measureIndex(index);\n      cache.values[id] = height;\n      return height;\n    }\n  };\n\n  return (\n    <VariableSizeList\n      layout=\"vertical\"\n      ref={listRef}\n      itemSize={itemSize}\n      height={height}\n      width={width}\n      itemCount={data.length}\n      {...variableSizeListProps}\n    >\n      {children}\n    </VariableSizeList>\n  );\n};\n\nexport default forwardRef(DynamicList);\n","import _ from \"lodash\";\n\nexport const possibleOutputs = [\n    `Lorem ipsum dolor sit amet, consectetur adipiscing elit.\n    Duis non nulla rhoncus, suscipit dolor nec, vehicula leo.\n    Curabitur ac metus eu nisl venenatis dapibus.\n    Fusce ornare erat ut urna laoreet, non venenatis enim varius.\n    Maecenas quis lacus finibus, dictum neque ac, pretium mi.\n    Aliquam pretium lorem ac nulla tincidunt laoreet.\n    Quisque feugiat urna eget facilisis mollis.\n    Cras imperdiet libero vitae elementum tristique.\n    In vestibulum purus a risus sollicitudin bibendum.\n    Praesent non purus varius, venenatis ante eget, imperdiet nisl.\n    Mauris ut dui tempus, suscipit neque sed, tempor libero.\n    Praesent eget nisi sed nunc porta egestas.\n    Suspendisse eget nunc et mi hendrerit tincidunt.\n    Vestibulum nec velit molestie, lacinia sapien sit amet, porta dolor.\n    Vivamus ac lectus suscipit, blandit augue eu, tempor dui.\n    Duis varius justo at euismod ultricies.\n    In sit amet lectus dignissim, tempus velit quis, posuere arcu.\n    Nunc vel erat et enim consequat pretium sed eget ex.\n    Integer cursus dui at nunc faucibus mattis.\n    Integer tempor urna ut malesuada pellentesque.\n    Donec consectetur ligula quis urna auctor eleifend.\n    Phasellus id diam et nunc lacinia vulputate vitae ac erat.\n    Curabitur cursus neque eget purus iaculis, eu blandit dui commodo.\n    Sed vel quam vitae urna ornare gravida.\n    Phasellus feugiat ex sit amet urna viverra porttitor et id ligula.\n    Nullam pretium odio vitae nibh semper tincidunt.\n    Aenean in nunc semper, congue nibh interdum, gravida neque.\n    Cras tincidunt nibh id dictum vehicula.\n    Phasellus suscipit tellus ut ex malesuada, aliquet aliquet massa lobortis.\n    Integer porttitor erat eget ante mollis accumsan.\n    Morbi id arcu vel dui fringilla accumsan.\n    Donec vel nulla a lacus convallis interdum.\n    Curabitur consectetur turpis at leo egestas iaculis.\n    Maecenas vitae mauris egestas, imperdiet turpis at, convallis mauris.\n    Vestibulum blandit felis placerat urna tincidunt, eu vestibulum quam pulvinar.\n    Duis hendrerit nulla vitae nulla egestas, eu hendrerit sapien consequat.\n    Duis facilisis nibh a sodales hendrerit.\n    Fusce aliquam erat ac blandit commodo.\n    Pellentesque elementum nunc id odio fermentum cursus.\n    Sed non elit placerat, porta elit vel, mollis orci.\n    Aliquam ac dolor volutpat, dapibus libero vel, suscipit eros.\n    Praesent egestas lacus at odio porttitor, finibus sodales neque aliquet.\n    Nulla facilisis nulla rutrum viverra scelerisque.\n    Sed eget nisi scelerisque, tincidunt tortor quis, tristique justo.\n    Pellentesque et felis vestibulum, placerat diam sit amet, pulvinar ex.\n    Nulla et odio non mi tincidunt dapibus nec at sapien.\n    Quisque quis urna non purus porttitor sagittis lobortis quis risus.\n    Aenean egestas enim eu placerat volutpat.\n    Ut sed ante in mauris laoreet tincidunt.\n    Quisque viverra ipsum interdum magna porta, vitae tempus ligula vehicula.\n    Integer laoreet sem id erat lobortis fermentum.\n    Quisque consectetur massa et dapibus convallis.\n    Maecenas id nunc id velit posuere congue in vel risus.\n    Proin quis est et risus interdum varius.\n    Nunc a urna vel turpis aliquet interdum.\n    Praesent elementum velit vel eleifend scelerisque.`,\n    `Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec est et libero dignissim aliquet in a nisi. Sed nunc lacus, consequat eget ante sed, interdum accumsan tellus. Nulla in augue velit. Duis erat massa, tincidunt nec aliquam facilisis, mattis vel arcu. Integer eu nisl eu eros fermentum fermentum nec sed arcu. Etiam rhoncus tempor rhoncus. Cras suscipit pellentesque ullamcorper.\n\n    Integer dapibus tristique urna, nec semper libero pellentesque eu. Mauris finibus magna suscipit lacus elementum gravida. Morbi massa elit, mollis sed vehicula fermentum, convallis quis erat. Nam non magna bibendum, cursus urna ac, aliquet leo. Donec vulputate pretium malesuada. Quisque eget sollicitudin urna, non mollis sapien. Integer sagittis, nulla facilisis ultricies tempus, ante lorem dictum turpis, sed vestibulum enim purus at ligula. Fusce tempor, nibh non tincidunt dictum, leo enim posuere massa, id laoreet magna nunc pellentesque felis. Sed vitae interdum nulla. Aliquam dui libero, efficitur at mi sit amet.`,\n    `\n    I am small\n    `,\n]\n\nexport const generateCommand = (index) => ({\n    id: index,\n    title: `some title ${index}`,\n    input: `some input ${index}`,\n    output: _.sample(possibleOutputs)\n})\n\nexport const generateCommands = () => (\n    _.range(0, 1000).map(generateCommand)\n)","import React, { useState, useRef, useEffect, useCallback } from \"react\";\n\nimport DynamicList, { createCache } from \"react-window-dynamic-list\";\nimport AutoSizer from \"react-virtualized-auto-sizer\";\n\nimport { generateCommands, generateCommand } from \"./utils\";\nimport { Input, InputNumber, Button } from \"antd\";\n\nimport \"antd/dist/antd.compact.min.css\";\nimport \"./App.css\";\n\nconst cache = createCache();\n\nconst App = () => {\n  const [commands, setCommands] = useState(generateCommands());\n  const [filter, setFilter] = useState(\"\");\n  const [row, setRow] = useState(200);\n  const [shouldShowList, setShouldShowList] = useState(true);\n  const dynamicListRef = useRef();\n\n  const filteredCommands = commands.filter(command =>\n    JSON.stringify(command).includes(filter)\n  );\n\n  const addCommand = () => {\n    setCommands([...commands, generateCommand(commands.length)]);\n  };\n\n  const handleFilterChange = event => {\n    setFilter(event.target.value);\n  };\n\n  const jumpToRow = useCallback(() => {\n    if (dynamicListRef.current) {\n      dynamicListRef.current.scrollToItem(row, \"start\");\n    }\n  }, [row]);\n\n  useEffect(jumpToRow, []);\n\n  useEffect(() => {\n    if (shouldShowList) {\n      jumpToRow();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [shouldShowList]);\n\n  return (\n    <div>\n      <header>\n        <h2>Dynamic list Example</h2>\n      </header>\n      <content>\n        <div className=\"filter-container\">\n          <div className=\"row\">\n            <label> Text Filter: </label>\n            <Input\n              value={filter}\n              onChange={handleFilterChange}\n              placeholder=\"Try filtering...\"\n            />\n          </div>\n          <div className=\"row\">\n            <label> Actions: </label>\n            <div>\n              <InputNumber\n                min={0}\n                max={filteredCommands.length - 1}\n                step={20}\n                onChange={setRow}\n                value={row}\n              />\n              <Button onClick={jumpToRow}> Jump! </Button>\n            </div>\n            <Button onClick={addCommand}> Add Item </Button>\n            <Button onClick={() => setShouldShowList(!shouldShowList)}>\n              {\" \"}\n              Toggle list{\" \"}\n            </Button>\n          </div>\n        </div>\n        <div className=\"dynamic-list-container\">\n          <AutoSizer>\n            {({ height, width }) =>\n              shouldShowList && (\n                <DynamicList\n                  cache={cache}\n                  ref={dynamicListRef}\n                  data={filteredCommands}\n                  width={width}\n                  height={height}\n                >\n                  {({ index, style }) => (\n                    <div style={style}>\n                      <h3> Row - {index} </h3>\n                      <pre\n                        style={{\n                          whiteSpace: \"inherit\",\n                          marginBottom: \"2em\"\n                        }}\n                      >\n                        {filteredCommands[index].output}\n                      </pre>{\" \"}\n                    </div>\n                  )}\n                </DynamicList>\n              )\n            }\n          </AutoSizer>\n        </div>\n      </content>\n    </div>\n  );\n};\n\nexport default App;\n","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}